{% extends "base.html" %}

{% block within_head %}
<style>
    .strike {
        text-decoration: line-through;
    }

    .gray {
        color: gray;
    }

    h1 {
        float: left;
        display: block;
        margin: 0 0 10px 10px;
    }

    div.top-container {
        display: block;
        padding: 20px 0 10px 0;
        float: right;
        position: relative;
        margin: 0 10px 0 0;
        width: 60%;
    }

    /* @formatter:off */
    div.w3-container.w3-blue.w3-round {
        width: {{ percentage }}%;
        height: 24px;
        padding: 0;
    }
    /* @formatter:on */

    ul {
        clear: both;
        margin: 0;
    }

    hr {
        clear: both;
    }

    .badge1 {
        position: relative;
    }

    .badge1[data-badge]:after {
        content: attr(data-badge);
        position: absolute;
        top: 12px;
        right: -8px;
        font-size: .3em;
        background: red;
        color: white;
        width: 18px;
        height: 18px;
        text-align: center;
        line-height: 18px;
        border-radius: 50%;
        box-shadow: 0 0 1px #333;
        font-weight: bold;
    }

    hr {
        margin: 10px 0;
    }

    pie {
        width: 15px;
        height: 15px;
        display: inline-block;
        border-radius: 50%;
        background-color: black;
        border: 2px solid black;
        top: 1px;
        position: relative;
        margin-right: 6px;
        margin-left: 19px;
    }

    div.task {
        height: 30px;
        margin-right: 10px;
        overflow: hidden;
    }

    div.pieAndTitle {
        display: inline-block;
        max-width: 80%;
    }

    div.buttons {
        display: inline-block;
        cursor: pointer;
        float: right;
    }

    .fas {
        margin-left: 10px;
        color: #cacaca;
    }
</style>
<script>
  function completeItem(service, id) {
    $("#" + service + "-" + id).find(".check").css("color", "green");
    updateItem(service, id, "complete")
  }

  function deferItem(service, id) {
    $("#" + service + "-" + id).find(".defer").css("color", "#111198");
    updateItem(service, id, "defer")
  }

  function updateItem(service, id, update_action) {
    if (service === "toodledo" || service === "habitica") {
      $
        .ajax({
          contentType: "application/json",
          data: JSON.stringify({
            "service": service,
            "id": id,
            "update": update_action
          }),
          type: "POST",
          url: "update_task"
        })
        .done(function () {
          $("#" + service + "-" + id).slideUp();
        });
    } else {
      alert("Unexpected service '" + service + "'!")
    }
  }
</script>
<script src="//kit.fontawesome.com/874826286d.js"></script>
{% endblock %}

{% block body %}
{% if num_unsorted_tasks > 0 %}
<a href="/prioritize"><h1 class="badge1" data-badge="{{ num_unsorted_tasks }}">zdone</h1></a>
{% else %}
<h1>zdone</h1>
{% endif %}

<div class="w3-container top-container">
    <div class="w3-light-grey w3-round-large">
        <div class="w3-container w3-blue w3-round"></div>
    </div>
    <!--
    <div style="display: inline-block;">{{ times['minutes_completed_today'] }}m done</div>
    <div style="float: right; display: inline-block;">{{ times['minutes_allocated'] }}m</div>
    -->
</div>
<hr>
<div class="tasks">
    {% for task in tasks_to_do %}
    <div class="task" id="{{ task.service }}-{{ task.id }}">
        <div class="pieAndTitle">
            <pie style="background-image: {{ task.pie_background_image }};"></pie>
            <span class="taskTitle">{{ task.name }}</span>
        </div>
        {% if task.service == "habitica" %}
        <div class="buttons">
            <i class="fas fa-check check" onclick="completeItem('{{ task.service }}', '{{ task.id }}')"></i><i
                class="fas fa-angle-double-right defer" onclick="deferItem('{{ task.service }}', '{{ task.id }}')"></i>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% endblock %}